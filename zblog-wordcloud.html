<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Zblog è¯äº‘ - 4K</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            background: #0a0a15;
            color: #fff;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Microsoft YaHei', sans-serif;
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 20px;
            min-height: 100vh;
        }
        h1 { margin-bottom: 10px; font-size: 2em; }
        .subtitle { color: #888; margin-bottom: 20px; }
        .controls {
            margin-bottom: 20px;
            display: flex;
            gap: 15px;
            flex-wrap: wrap;
            justify-content: center;
        }
        button {
            background: linear-gradient(135deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: transform 0.2s;
        }
        button:hover { transform: scale(1.05); }
        .canvas-container {
            background: #1a1a2e;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.5);
        }
        canvas {
            display: block;
            max-width: 100%;
            height: auto;
        }
        .info {
            margin-top: 15px;
            color: #666;
            font-size: 14px;
        }
    </style>
    <meta name="description" content="åŸºäºZblogæ–‡ç« ç”Ÿæˆçš„4Kè¯äº‘å›¾ï¼Œå±•ç¤ºçƒ­é—¨å…³é”®è¯å’Œæ ‡ç­¾ã€‚æ¯å°æ—¶æ›´æ–°ï¼Œå¯è§†åŒ–åšå®¢å†…å®¹è¶‹åŠ¿ã€‚">
    <meta name="keywords" content="è¯äº‘,Zblog,åšå®¢åˆ†æ,å…³é”®è¯,æ•°æ®å¯è§†åŒ–">
    <link rel="canonical" href="https://monitor.kisara.info/zblog-wordcloud.html">
    <meta property="og:title" content="åšå®¢è¯äº‘ - Kisaraå¯è§†åŒ–ä¸­å¿ƒ">
    <meta property="og:description" content="Zblogæ–‡ç« å…³é”®è¯è¯äº‘å¯è§†åŒ–">
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://monitor.kisara.info/zblog-wordcloud.html">
</head>
<body>
    <h1>ğŸŒ¥ï¸ Kisara Blog è¯äº‘</h1>
    <p class="subtitle">åŸºäºæœ€æ–° 100 ç¯‡æ–‡ç« ç”Ÿæˆ Â· 4K åˆ†è¾¨ç‡</p>
    
    <div class="controls">
        <button onclick="render4K()">æ¸²æŸ“ 4K è¯äº‘</button>
        <button onclick="downloadPNG()">ä¸‹è½½ PNG</button>
    </div>
    
    <div class="canvas-container">
        <canvas id="wordcloud"></canvas>
    </div>
    
    <p class="info">æç¤ºï¼šç‚¹å‡»"æ¸²æŸ“ 4K è¯äº‘"ç”Ÿæˆé«˜åˆ†è¾¨ç‡å›¾ç‰‡ï¼Œå³é”®æˆ–ç‚¹å‡»ä¸‹è½½ä¿å­˜</p>

    <script>
        let wordData = null;
        let canvas = document.getElementById('wordcloud');
        let ctx = canvas.getContext('2d');
        
        // åŠ è½½æ•°æ®
        async function loadData() {
            try {
                const res = await fetch('../zblog-wordcloud.json');
                wordData = await res.json();
                console.log('Loaded', wordData.totalWords, 'words');
                renderPreview();
            } catch (e) {
                console.error('Failed to load data:', e);
            }
        }
        
        // é¢„è§ˆæ¸²æŸ“ï¼ˆ1080pï¼‰
        function renderPreview() {
            render(1920, 1080, 0.5);
        }
        
        // 4K æ¸²æŸ“
        function render4K() {
            render(3840, 2160, 1);
        }
        
        // æ¸²æŸ“è¯äº‘
        function render(width, height, scale) {
            if (!wordData) return;
            
            canvas.width = width;
            canvas.height = height;
            
            // èƒŒæ™¯
            const gradient = ctx.createLinearGradient(0, 0, width, height);
            gradient.addColorStop(0, '#1a1a2e');
            gradient.addColorStop(0.5, '#16213e');
            gradient.addColorStop(1, '#0f3460');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, width, height);
            
            // æ ‡é¢˜
            ctx.fillStyle = '#ffffff';
            ctx.font = `bold ${80 * scale}px "Microsoft YaHei", sans-serif`;
            ctx.textAlign = 'center';
            ctx.fillText('Kisara Blog è¯äº‘', width / 2, 120 * scale);
            
            ctx.font = `${36 * scale}px "Microsoft YaHei", sans-serif`;
            ctx.fillStyle = '#888888';
            ctx.fillText(`åŸºäº ${wordData.totalWords} ä¸ªå…³é”®è¯ Â· ${new Date().toLocaleDateString('zh-CN')}`, width / 2, 180 * scale);
            
            // èºæ—‹å¸ƒå±€
            const centerX = width / 2;
            const centerY = height / 2 + 50 * scale;
            const placedWords = [];
            
            function checkCollision(x, y, w, h) {
                for (const p of placedWords) {
                    if (x < p.x + p.w && x + w > p.x && y < p.y + p.h && y + h > p.y) {
                        return true;
                    }
                }
                return false;
            }
            
            function drawWord(text, size, color) {
                ctx.font = `bold ${size * scale}px "Microsoft YaHei", sans-serif`;
                const metrics = ctx.measureText(text);
                const w = metrics.width;
                const h = size * scale;
                
                let angle = 0;
                let radius = 0;
                let x, y;
                let attempts = 0;
                
                do {
                    x = centerX + Math.cos(angle) * radius;
                    y = centerY + Math.sin(angle) * radius;
                    
                    if (x - w/2 < 50 || x + w/2 > width - 50 ||
                        y - h/2 < 220 * scale || y + h/2 > height - 50) {
                        angle += 0.5;
                        radius += 5;
                        attempts++;
                        continue;
                    }
                    
                    if (!checkCollision(x - w/2, y - h/2, w, h)) {
                        break;
                    }
                    
                    angle += 0.3;
                    radius += 3;
                    attempts++;
                } while (attempts < 300);
                
                // ç»˜åˆ¶
                ctx.fillStyle = color;
                ctx.textAlign = 'center';
                ctx.textBaseline = 'middle';
                
                // å‘å…‰æ•ˆæœ
                ctx.shadowColor = color + '40';
                ctx.shadowBlur = 20 * scale;
                
                ctx.fillText(text, x, y);
                
                ctx.shadowBlur = 0;
                
                placedWords.push({ x: x - w/2, y: y - h/2, w, h });
            }
            
            // ç»˜åˆ¶å¤§å­—
            wordData.layers.large.forEach(w => drawWord(w.text, w.size * 2, w.color));
            
            // ç»˜åˆ¶ä¸­å­—
            wordData.layers.medium.forEach(w => drawWord(w.text, w.size * 2, w.color));
            
            // ç»˜åˆ¶å°å­—
            wordData.layers.small.forEach(w => drawWord(w.text, w.size * 2, w.color));
            
            console.log(`Rendered ${width}x${height}`);
        }
        
        // ä¸‹è½½ PNG
        function downloadPNG() {
            const link = document.createElement('a');
            link.download = `zblog-wordcloud-4k-${new Date().toISOString().split('T')[0]}.png`;
            link.href = canvas.toDataURL('image/png');
            link.click();
        }
        
        // åŠ è½½æ•°æ®
        loadData();
    </script>
</body>
</html>
