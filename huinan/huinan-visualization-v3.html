<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹¿å·å›å—å¤©ç›‘æµ‹ - v3 (åŠ¨æ€ç‰ˆ)</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { background: #1a1a2e; color: #eee; font-family: sans-serif; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        h1 { text-align: center; margin-bottom: 10px; color: #fff; }
        .subtitle { text-align: center; color: #888; margin-bottom: 20px; font-size: 14px; }
        .stats { display: flex; justify-content: center; gap: 30px; margin-bottom: 20px; flex-wrap: wrap; }
        .stat-item { background: #16213e; padding: 15px 30px; border-radius: 8px; text-align: center; min-width: 120px; }
        .stat-value { font-size: 28px; font-weight: bold; color: #00d9ff; }
        .stat-label { font-size: 12px; color: #888; margin-top: 5px; }
        .stat-value.loading { color: #666; }
        .chart-container { background: #16213e; border-radius: 12px; padding: 20px; margin-bottom: 20px; }
        .main-chart { height: 400px; }
        .sub-charts { display: grid; grid-template-columns: 1fr 1fr; gap: 20px; margin-top: 20px; }
        .sub-chart { height: 200px; }
        .legend { display: flex; justify-content: center; gap: 20px; margin-top: 20px; flex-wrap: wrap; font-size: 12px; }
        .legend-item { display: flex; align-items: center; gap: 5px; }
        .legend-color { width: 20px; height: 10px; border-radius: 2px; }
        .error-msg { text-align: center; color: #ff6b6b; padding: 20px; }
        .update-time { text-align: center; color: #666; font-size: 12px; margin-top: 10px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ«ï¸ å¹¿å·å›å—å¤©ç›‘æµ‹</h1>
        <p class="subtitle">å…­æ­¥ç®—æ³•ï¼šæ ¸å¿ƒè§¦å‘ â†’ ç½®ä¿¡åº¦è¯„åˆ† â†’ å¼ºåº¦åˆ†çº§ â†’ é˜²æŠ– â†’ é€šçŸ¥ â†’ ç»Ÿè®¡</p>
        
        <div class="stats" id="statsContainer">
            <div class="stat-item"><div class="stat-value loading">--</div><div class="stat-label">æ•°æ®ç‚¹æ•°</div></div>
            <div class="stat-item"><div class="stat-value loading">--</div><div class="stat-label">æœ€é«˜ç½®ä¿¡åº¦</div></div>
            <div class="stat-item"><div class="stat-value loading">--</div><div class="stat-label">å½“å‰æ¹¿åº¦</div></div>
        </div>
        <div class="update-time" id="updateTime">åŠ è½½ä¸­...</div>
        
        <div class="chart-container">
            <div id="mainChart" class="main-chart"></div>
            <div class="sub-charts">
                <div id="windChart" class="sub-chart"></div>
                <div id="pressureChart" class="sub-chart"></div>
            </div>
        </div>
        
        <div class="legend">
            <div class="legend-item"><div class="legend-color" style="background:#5470c6"></div><span>æ¹¿åº¦</span></div>
            <div class="legend-item"><div class="legend-color" style="background:#91cc75"></div><span>æ¸©åº¦</span></div>
            <div class="legend-item"><div class="legend-color" style="background:#fac858"></div><span>éœ²ç‚¹</span></div>
        </div>
    </div>

    <script>
        async function loadData() {
            try {
                const detailedRes = await fetch('../data/huinan-detailed.json');
                const detailed = await detailedRes.json();
                const currentRes = await fetch('../data/huinan-data.json');
                const current = await currentRes.json();
                return { detailed, current };
            } catch (e) {
                console.error('åŠ è½½å¤±è´¥:', e);
                return null;
            }
        }

        function formatTime(t) {
            if (!t) return '';
            if (t.includes('T')) {
                const d = new Date(t);
                return `${(d.getMonth()+1).toString().padStart(2,'0')}-${d.getDate().toString().padStart(2,'0')} ${d.getHours().toString().padStart(2,'0')}:${d.getMinutes().toString().padStart(2,'0')}`;
            }
            const p = t.split(' ');
            if (p.length === 2) {
                const dp = p[0].split('-');
                return `${dp[1]}-${dp[2]} ${p[1].substring(0,5)}`;
            }
            return t;
        }

        function updateStats(detailed, current) {
            const records = detailed.records || [];
            const dataCount = records.length;
            const maxConf = records.length ? Math.max(...records.map(r => r.confidence?.score || 0)) : 0;
            const curHum = current.humidity || 0;
            const updTime = current.updatedAt ? new Date(current.updatedAt).toLocaleString('zh-CN') : 'æœªçŸ¥';
            
            document.getElementById('statsContainer').innerHTML = `
                <div class="stat-item"><div class="stat-value">${dataCount}</div><div class="stat-label">æ•°æ®ç‚¹æ•°</div></div>
                <div class="stat-item"><div class="stat-value">${maxConf}/3</div><div class="stat-label">æœ€é«˜ç½®ä¿¡åº¦</div></div>
                <div class="stat-item"><div class="stat-value" style="color:${curHum>80?'#ff6b6b':'#00d9ff'}">${curHum}%</div><div class="stat-label">å½“å‰æ¹¿åº¦</div></div>
            `;
            document.getElementById('updateTime').textContent = `æœ€åæ›´æ–°: ${updTime}`;
        }

        function renderCharts(detailed) {
            const records = detailed.records || [];
            const times = records.map(r => formatTime(r.time));
            const humidity = records.map(r => r.humidity);
            const temp = records.map(r => r.temp);
            const dew = records.map(r => r.dew);
            const windSpeed = records.map(r => r.windSpeed);
            const pressure = records.map(r => r.pressure);

            const mainChart = echarts.init(document.getElementById('mainChart'));
            mainChart.setOption({
                backgroundColor: 'transparent',
                tooltip: { trigger: 'axis', backgroundColor: 'rgba(22,33,62,0.95)', textStyle: { color: '#eee' } },
                legend: { data: ['æ¹¿åº¦', 'æ¸©åº¦', 'éœ²ç‚¹'], textStyle: { color: '#eee' }, top: 10 },
                grid: { left: '3%', right: '4%', bottom: '12%', top: '15%', containLabel: true },
                xAxis: { type: 'category', data: times, axisLine: { lineStyle: { color: '#555' } }, axisLabel: { color: '#888', rotate: 45, fontSize: 10 } },
                yAxis: { type: 'value', name: 'æ•°å€¼', axisLine: { lineStyle: { color: '#555' } }, axisLabel: { color: '#888' }, splitLine: { lineStyle: { color: '#333' } } },
                series: [
                    { name: 'æ¹¿åº¦', type: 'line', data: humidity, smooth: true, symbol: 'circle', symbolSize: 4, lineStyle: { color: '#5470c6', width: 2 }, itemStyle: { color: '#5470c6' } },
                    { name: 'æ¸©åº¦', type: 'line', data: temp, smooth: true, symbol: 'circle', symbolSize: 4, lineStyle: { color: '#91cc75', width: 2 }, itemStyle: { color: '#91cc75' } },
                    { name: 'éœ²ç‚¹', type: 'line', data: dew, smooth: true, symbol: 'circle', symbolSize: 4, lineStyle: { color: '#fac858', width: 2 }, itemStyle: { color: '#fac858' } }
                ]
            });

            const windChart = echarts.init(document.getElementById('windChart'));
            windChart.setOption({
                backgroundColor: 'transparent',
                title: { text: 'é£é€Ÿ', left: 'center', textStyle: { color: '#eee', fontSize: 14 } },
                tooltip: { trigger: 'axis', backgroundColor: 'rgba(22,33,62,0.95)', textStyle: { color: '#eee' } },
                grid: { left: '3%', right: '4%', bottom: '10%', top: '25%', containLabel: true },
                xAxis: { type: 'category', data: times, axisLine: { lineStyle: { color: '#555' } }, axisLabel: { show: false } },
                yAxis: { type: 'value', name: 'km/h', axisLine: { lineStyle: { color: '#555' } }, axisLabel: { color: '#888' }, splitLine: { lineStyle: { color: '#333' } } },
                series: [{ name: 'é£é€Ÿ', type: 'bar', data: windSpeed, itemStyle: { color: '#87ceeb' } }]
            });

            const pressureChart = echarts.init(document.getElementById('pressureChart'));
            pressureChart.setOption({
                backgroundColor: 'transparent',
                title: { text: 'æ°”å‹', left: 'center', textStyle: { color: '#eee', fontSize: 14 } },
                tooltip: { trigger: 'axis', backgroundColor: 'rgba(22,33,62,0.95)', textStyle: { color: '#eee' } },
                grid: { left: '3%', right: '4%', bottom: '10%', top: '25%', containLabel: true },
                xAxis: { type: 'category', data: times, axisLine: { lineStyle: { color: '#555' } }, axisLabel: { show: false } },
                yAxis: { type: 'value', name: 'hPa', min: 1000, max: 1020, axisLine: { lineStyle: { color: '#555' } }, axisLabel: { color: '#888' }, splitLine: { lineStyle: { color: '#333' } } },
                series: [{ name: 'æ°”å‹', type: 'line', data: pressure, smooth: true, lineStyle: { color: '#ff9f7f' }, itemStyle: { color: '#ff9f7f' } }]
            });

            window.addEventListener('resize', () => { mainChart.resize(); windChart.resize(); pressureChart.resize(); });
        }

        async function init() {
            const data = await loadData();
            if (data) {
                updateStats(data.detailed, data.current);
                renderCharts(data.detailed);
            } else {
                document.getElementById('statsContainer').innerHTML = '<div class="error-msg">æ•°æ®åŠ è½½å¤±è´¥</div>';
            }
        }

        init();
    </script>
</body>
</html>
