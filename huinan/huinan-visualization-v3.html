<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¹¿å·å›å—å¤©ç›‘æµ‹ - å¯è§†åŒ– v3</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        body {
            background: #1a1a2e;
            color: #eee;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
        }
        .container {
            max-width: 1400px;
            margin: 0 auto;
        }
        h1 {
            text-align: center;
            margin-bottom: 10px;
            color: #fff;
        }
        .subtitle {
            text-align: center;
            color: #888;
            margin-bottom: 30px;
            font-size: 14px;
        }
        .chart-container {
            background: #16213e;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .main-chart {
            height: 400px;
        }
        .sub-charts {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }
        .sub-chart {
            height: 200px;
        }
        .legend {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 13px;
        }
        .legend-color {
            width: 20px;
            height: 12px;
            border-radius: 2px;
        }
        .annotation-card {
            position: fixed;
            background: #0f3460;
            border: 1px solid #e94560;
            border-radius: 8px;
            padding: 15px;
            max-width: 300px;
            display: none;
            z-index: 1000;
            box-shadow: 0 4px 20px rgba(0,0,0,0.5);
        }
        .annotation-card h4 {
            margin-bottom: 10px;
            color: #e94560;
        }
        .annotation-card .item {
            margin: 5px 0;
            font-size: 13px;
        }
        .annotation-card .check {
            color: #4ecca3;
        }
        .annotation-card .cross {
            color: #e94560;
        }
        .confidence-bar {
            height: 10px;
            background: linear-gradient(to right, 
                #666 0%, #666 33%,
                #87ceeb 33%, #87ceeb 66%,
                #4169e1 66%, #4169e1 100%
            );
            border-radius: 2px;
            margin-top: 5px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸŒ«ï¸ å¹¿å·å›å—å¤©ç›‘æµ‹</h1>
        <p class="subtitle">å…­æ­¥ç®—æ³•ï¼šæ ¸å¿ƒè§¦å‘ â†’ ç½®ä¿¡åº¦è¯„åˆ† â†’ å¼ºåº¦åˆ†çº§ â†’ é˜²æŠ– â†’ é€šçŸ¥ â†’ ç»Ÿè®¡</p>
        
        <div class="chart-container">
            <div id="mainChart" class="main-chart"></div>
            <div class="sub-charts">
                <div id="windChart" class="sub-chart"></div>
                <div id="pressureChart" class="sub-chart"></div>
            </div>
        </div>
        
        <div class="legend">
            <div class="legend-item">
                <div class="legend-color" style="background: #5470c6;"></div>
                <span>æ¹¿åº¦ (%)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #91cc75;"></div>
                <span>æ¸©åº¦ (Â°C)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: #fac858;"></div>
                <span>éœ²ç‚¹ (Â°C)</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: rgba(233, 69, 96, 0.3);"></div>
                <span>85%æ¹¿åº¦åŸºçº¿</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: rgba(147, 112, 219, 0.5);"></div>
                <span>æ­£å¼å›å—å¤©</span>
            </div>
            <div class="legend-item">
                <div class="legend-color" style="background: rgba(147, 112, 219, 0.25);"></div>
                <span>ç–‘ä¼¼å›å—å¤©</span>
            </div>
        </div>
    </div>
    
    <div id="annotationCard" class="annotation-card"></div>

    <script>
        // æ•°æ®
        const times = ["2026-02-19T11:45:39.724Z"];
        const humidity = [76];
        const temp = [17];
        const dew = [12];
        const windDir = [0];
        const windSpeed = [1];
        const pressure = [1013];
        const confidenceScores = [1];
        const coreTriggers = [{"allOK": false, "humidityOK": false, "dewDiffOK": false, "humidityTrendOK": true, "tempDewDiff": 5}];
        const intensityLevels = ["none"];
        const eventAnnotations = [];
        
        // è®¡ç®—ç½®ä¿¡åº¦è‰²å¸¦æ•°æ®
        const confidenceBands = confidenceScores.map((score, idx) => {
            const colors = ['#666666', '#87ceeb', '#4169e1', '#000080'];
            return {
                xAxis: times[idx],
                yAxis: 0,
                itemStyle: {
                    color: colors[score] || '#666666',
                    opacity: 0.3
                }
            };
        });
        
        // è®¡ç®—å›å—å¤©é«˜äº®åŒºåŸŸ
        const nanhuiRegions = [];
        let startIdx = null;
        let isFormal = false;
        let level = 'none';
        
        for (let i = 0; i < times.length; i++) {
            const isNanhui = coreTriggers[i].allOK;
            const currentLevel = intensityLevels[i];
            const confidence = confidenceScores[i];
            
            if (isNanhui && startIdx === null) {
                startIdx = i;
                isFormal = confidence >= 1;
                level = currentLevel;
            } else if ((!isNanhui || i === times.length - 1) && startIdx !== null) {
                nanhuiRegions.push({
                    start: times[startIdx],
                    end: times[i],
                    formal: isFormal,
                    level: level
                });
                startIdx = null;
            }
        }
        
        // ä¸»å›¾é…ç½®
        const mainChart = echarts.init(document.getElementById('mainChart'));
        const mainOption = {
            backgroundColor: 'transparent',
            tooltip: {
                trigger: 'axis',
                axisPointer: { type: 'cross' },
                backgroundColor: 'rgba(22, 33, 62, 0.95)',
                borderColor: '#e94560',
                textStyle: { color: '#eee' }
            },
            legend: {
                data: ['æ¹¿åº¦', 'æ¸©åº¦', 'éœ²ç‚¹', '85%åŸºçº¿'],
                textStyle: { color: '#eee' },
                top: 10
            },
            grid: {
                left: '3%',
                right: '4%',
                bottom: '15%',
                top: '15%',
                containLabel: true
            },
            xAxis: {
                type: 'category',
                data: times,
                axisLine: { lineStyle: { color: '#555' } },
                axisLabel: { color: '#888', rotate: 45 }
            },
            yAxis: {
                type: 'value',
                name: 'æ•°å€¼',
                axisLine: { lineStyle: { color: '#555' } },
                axisLabel: { color: '#888' },
                splitLine: { lineStyle: { color: '#333' } }
            },
            series: [
                {
                    name: 'æ¹¿åº¦',
                    type: 'line',
                    data: humidity,
                    smooth: true,
                    lineStyle: { color: '#5470c6', width: 2 },
                    itemStyle: { color: '#5470c6' }
                },
                {
                    name: 'æ¸©åº¦',
                    type: 'line',
                    data: temp,
                    smooth: true,
                    lineStyle: { color: '#91cc75', width: 2 },
                    itemStyle: { color: '#91cc75' }
                },
                {
                    name: 'éœ²ç‚¹',
                    type: 'line',
                    data: dew,
                    smooth: true,
                    lineStyle: { color: '#fac858', width: 2 },
                    itemStyle: { color: '#fac858' }
                },
                {
                    name: '85%åŸºçº¿',
                    type: 'line',
                    data: times.map(() => 85),
                    lineStyle: { color: '#e94560', type: 'dashed', width: 1 },
                    symbol: 'none'
                }
            ],
            // ç½®ä¿¡åº¦è‰²å¸¦ï¼ˆåº•éƒ¨ï¼‰
            graphic: confidenceScores.map((score, idx) => ({
                type: 'rect',
                left: `${(idx / times.length) * 100}%`,
                bottom: '2%',
                shape: {
                    width: `${(1 / times.length) * 100}%`,
                    height: 10
                },
                style: {
                    fill: ['#666666', '#87ceeb', '#4169e1', '#000080'][score] || '#666666'
                }
            }))
        };
        
        // æ·»åŠ å›å—å¤©é«˜äº®åŒºåŸŸ
        nanhuiRegions.forEach(region => {
            mainOption.series.push({
                type: 'line',
                markArea: {
                    silent: true,
                    itemStyle: {
                        color: region.formal ? 'rgba(147, 112, 219, 0.3)' : 'rgba(147, 112, 219, 0.15)'
                    },
                    data: [[
                        { xAxis: region.start },
                        { xAxis: region.end }
                    ]]
                }
            });
        });
        
        mainChart.setOption(mainOption);
        
        // é£å‘é£é€Ÿå›¾
        const windChart = echarts.init(document.getElementById('windChart'));
        const windOption = {
            backgroundColor: 'transparent',
            title: { text: 'é£å‘é£é€Ÿ', left: 'center', textStyle: { color: '#eee', fontSize: 14 } },
            tooltip: {
                trigger: 'axis',
                backgroundColor: 'rgba(22, 33, 62, 0.95)',
                borderColor: '#e94560',
                textStyle: { color: '#eee' }
            },
            grid: { left: '3%', right: '4%', bottom: '10%', top: '20%', containLabel: true },
            xAxis: {
                type: 'category',
                data: times,
                axisLine: { lineStyle: { color: '#555' } },
                axisLabel: { show: false }
            },
            yAxis: {
                type: 'value',
                name: 'é£é€Ÿ(km/h)',
                axisLine: { lineStyle: { color: '#555' } },
                axisLabel: { color: '#888' },
                splitLine: { lineStyle: { color: '#333' } }
            },
            series: [{
                name: 'é£é€Ÿ',
                type: 'line',
                data: windSpeed,
                smooth: true,
                lineStyle: { color: '#00d9ff', width: 2 },
                areaStyle: { color: 'rgba(0, 217, 255, 0.1)' }
            }],
            // é£å‘èƒŒæ™¯è‰²ï¼ˆ135-225Â°ä¸ºç»¿è‰²ï¼‰
            graphic: windDir.map((dir, idx) => {
                const isGoodWind = dir >= 135 && dir <= 225;
                return {
                    type: 'rect',
                    left: `${(idx / times.length) * 100}%`,
                    top: '15%',
                    shape: {
                        width: `${(1 / times.length) * 100}%`,
                        height: '75%'
                    },
                    style: {
                        fill: isGoodWind ? 'rgba(78, 204, 163, 0.2)' : 'transparent'
                    }
                };
            })
        };
        windChart.setOption(windOption);
        
        // æ°”å‹å›¾
        const pressureChart = echarts.init(document.getElementById('pressureChart'));
        
        // è®¡ç®—æ°”å‹å˜åŒ–é¢œè‰²
        const pressureColors = pressure.map((p, idx) => {
            if (idx === 0) return '#00d9ff';
            const prev = pressure[idx - 1];
            return p >= prev ? '#e94560' : '#4ecca3'; // ä¸Šå‡çº¢ï¼Œä¸‹é™ç»¿
        });
        
        const pressureOption = {
            backgroundColor: 'transparent',
            title: { text: 'æ°”å‹', left: 'center', textStyle: { color: '#eee', fontSize: 14 } },
            tooltip: {
                trigger: 'axis',
                backgroundColor: 'rgba(22, 33, 62, 0.95)',
                borderColor: '#e94560',
                textStyle: { color: '#eee' }
            },
            grid: { left: '3%', right: '4%', bottom: '10%', top: '20%', containLabel: true },
            xAxis: {
                type: 'category',
                data: times,
                axisLine: { lineStyle: { color: '#555' } },
                axisLabel: { show: false }
            },
            yAxis: {
                type: 'value',
                name: 'æ°”å‹(hPa)',
                axisLine: { lineStyle: { color: '#555' } },
                axisLabel: { color: '#888' },
                splitLine: { lineStyle: { color: '#333' } }
            },
            series: [{
                name: 'æ°”å‹',
                type: 'line',
                data: pressure,
                smooth: true,
                lineStyle: { width: 2 },
                itemStyle: { color: '#00d9ff' },
                // æ ¹æ®å˜åŒ–ç€è‰²
                areaStyle: {
                    color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                        { offset: 0, color: 'rgba(0, 217, 255, 0.3)' },
                        { offset: 1, color: 'rgba(0, 217, 255, 0.05)' }
                    ])
                }
            }]
        };
        pressureChart.setOption(pressureOption);
        
        // è”åŠ¨
        echarts.connect([mainChart, windChart, pressureChart]);
        
        // å“åº”å¼
        window.addEventListener('resize', () => {
            mainChart.resize();
            windChart.resize();
            pressureChart.resize();
        });
    </script>
</body>
</html>